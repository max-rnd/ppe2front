<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Créer un artiste</title>
    <link rel="stylesheet" href="../style/bootstrap.css">
    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap.bundle.js"></script>
</head>
<body>
<form id="FormLogBDD" name="form" method="post" enctype="multipart/form-data">
    <h1>Créer un artiste</h1>
    <div class="form-group">
        <label for="Nom">Nom</label>
        <input id="nom" type="text" name="nom" />
    </div>
    <div class="form-group">
        <label for="Prenom">Prénom</label>
        <input id="prenom" type="text" name="prenom" />
    </div>
   <div class="form-group">
        <label for="portait">Portait</label>
        <input id="portait" type="file" name="portait" />
    </div>
    <div class="form-group">
        <label for="resuBio">Résumé Biographie</label>
        <input id="resuBio" type="text" name="resuBio" />
    </div>
    <div class="form-group">
        <label for="bio">Biographie</label>
        <input id="bio" type="text" name="bio" />
    </div>

    <button type="button" class="btn btn-primary" id="btncreer">Créer l'artiste </button>
</form>

<script>
    $(function(){           // attend que le document soit complétement chargé dans le dom
    $("#btncreer").click(function() {
        // Créer le formdata en passant directement les données du formulaires
        let fd = new FormData(document.querySelector("#FormLogBDD"));
        
        /* ou en passant les données une par une (pour en ajouter ou en enlever par exemple)
        var fd = new FormData();
        fd.append("Nom",$("#Nom").val());
        fd.append("DateDebut",$("#dd").val());
        fd.append("DateFin",$("#df").val());*/

        fd.append("nomAffiche",$("#af")[0].files[0]);   //on ajoute le fichier dans le formData
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/expos",
            data : fd , //$("#FormLogBDD").serialize(),
            contentType: false,     //nécessaire car passage de fichier
            processData: false,     //nécessaire car passage de fichier
            dataType: "json",       //nécessaire car le service web retourne l'objet inséré en bdd en json
            success: function (val) {
                if(val.id!=0) {             // si id=0 c'est que l'insertion ne s'est pas faite
                    $("#Nom").val("");
                    $("#dd").val("");
                    $("#df").val("");
                    $("#af").val("");
                } else alert("l'insertion ne s'est pas faite :-(");
            },
            error: function (jqXHR,status,t) {
                alert("Malédiction c'est pas bon");     // problème réseau
            }
        });
    });
    });
</script>
</body>
</html>
